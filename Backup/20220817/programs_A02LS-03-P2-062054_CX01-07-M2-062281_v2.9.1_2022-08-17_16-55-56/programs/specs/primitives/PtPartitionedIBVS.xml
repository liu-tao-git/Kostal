<?xml version="1.0"?>
<fvr>
    <primitive>
        <pt_desc>This primitive does an Image Based Visual Servo (IBVS) with point feature points on a same planar. The goal is to
        align an object position with a target position defined in the camera image frame
        with the motion of the robot. User can specify the target object position,
        visual servo gains, camera mounting mode in input parameters. It is commonly used as
         a high precision positioning primitive. Notice: the input target feature points must
         be vertexes of a convex polygon in continues sequence</pt_desc>
        <!-- ===================================================================
         input parameter configuration

         par_type : "CART_POS", "QUAT", "POSE", "BOOL", "DOUBLE", "INT", "STRING"
         ====================================================================-->
        <input_par_config>
            <par_name> maxVel </par_name>
            <par_desc> "maximum Cartesian linear velocity" </par_desc>
            <par_type> DOUBLE </par_type>
            <par_unit> m/s </par_unit>
            <par_required> 0 </par_required>
            <par_default> 0.1 </par_default>
            <par_max> 2.0 </par_max>
            <par_min> 0.0 </par_min>
        </input_par_config>
        <input_par_config>
            <par_name> maxRotVel </par_name>
            <par_desc> "maximum Cartesian angular velocity " </par_desc>
            <par_type> DOUBLE </par_type>
            <par_unit> deg/s </par_unit>
            <par_required> 0 </par_required>
            <par_default>20.0 </par_default>
        </input_par_config>
        <input_par_config>
            <par_name> motionAxis </par_name>
            <par_desc> "allowed motion axis during visual servo in camera coordinate" </par_desc>
            <par_type> VEC_6i </par_type>
            <par_unit> none </par_unit>
            <par_required> 0 </par_required>
            <par_default> 1 1 1 1 1 1 </par_default>
        </input_par_config>
        <input_par_config>
            <par_name> targetFeaturePoints </par_name>
            <par_desc> "target feature points in the image, two cooridinates for one point (pixel)" </par_desc>
            <par_type> ARRAY_DOUBLE</par_type>
            <par_unit> none </par_unit>
            <par_required> 1 </par_required>
        </input_par_config>
        <input_par_config>
            <par_name> vsSpeedScale</par_name>
            <par_desc> "scale to speed up visual servo velocity. Mainly works near targets
                        feature points. May cause vibration if set too large" </par_desc>
            <par_type> DOUBLE </par_type>
            <par_unit> none </par_unit>
            <par_required> 0 </par_required>
            <par_default> 1 </par_default>
        </input_par_config>
        <input_par_config>
            <par_name> imgConvTol</par_name>
            <par_desc> "convergent tolerance for IBVS in pixel" </par_desc>
            <par_type> INT </par_type>
            <par_unit> none </par_unit>
            <par_required> 0 </par_required>
            <par_default> 5.0 </par_default>
        </input_par_config>
        <input_par_config>
            <par_name> isFixCam </par_name>
            <par_desc> "flag if using fixed camera" </par_desc>
            <par_type> BOOL </par_type>
            <par_unit> none </par_unit>
            <par_required> 0 </par_required>
            <par_default> 0 </par_default>
        </input_par_config>
        <input_par_config>
            <par_name> initDepth </par_name>
            <par_desc> "initial estimated feature point depth in camera frame in meter" </par_desc>
            <par_type> DOUBLE </par_type>
            <par_unit> m </par_unit>
            <par_required> 0 </par_required>
            <par_default> 0.22 </par_default>
        </input_par_config>
        <input_par_config>
            <par_name> objName </par_name>
            <par_desc> "object's name" </par_desc>
            <par_type> OBJNAME </par_type>
            <par_unit> none </par_unit>
            <par_required> 1 </par_required>
        </input_par_config>
        <input_par_config>
            <par_name> camId </par_name>
            <par_desc> "camera id" </par_desc>
            <par_type> INT </par_type>
            <par_unit> none </par_unit>
            <par_required> 1 </par_required>
        </input_par_config>
        <input_par_config>
            <par_name> maxVSPredTime</par_name>
            <par_desc> "max forward prediction time during AI commuication interval.
                        10~20ms is recommended when visual servo commuication interval is around 30Hz" </par_desc>
            <par_type> DOUBLE </par_type>
            <par_unit> ms </par_unit>
            <par_required> 0 </par_required>
            <par_default> 0 </par_default>
        </input_par_config>
        <!-- ===================================================================
         state parameter configuration
         ====================================================================-->
        <state_par_config>
            <par_name> reachedTarget </par_name>
            <par_desc> "flag to indicate if the camera has reached target" </par_desc>
            <par_type> BOOL</par_type>
            <par_unit> none </par_unit>
        </state_par_config>
        <!-- ===================================================================
                output parameter configuration
         ====================================================================-->
        <!-- ==================================================================
         default transition condition
          condition_type : trigger condition type
          lhs_param_name : LHS parameter name. It must be one of the state parameters in primitive
          lhs_param_category : LHS parameter category. This should be PT_STATE for now
          rhs_param_name (optional): RHS parameter name. no need to fill this field if rhs is a constant.
          rhs_param_category : RHS parameter category
          rhs_param_data (optional) : RHS parameter data.
         ====================================================================-->
        <default_transition_condition>
            <condition_type> EQUAL</condition_type>
            <lhs_param_name>reachedTarget</lhs_param_name>
            <lhs_param_category>PT_STATE</lhs_param_category>
            <rhs_param_category>CONST</rhs_param_category>
            <rhs_param_data>1</rhs_param_data>
        </default_transition_condition>
    </primitive>
</fvr>
