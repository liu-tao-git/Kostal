<?xml version="1.0"?>
<fvr>
    <primitive>
        <pt_desc>nThis primitive is designed for screw fastening task and customized 
        for commercial high-end screw gun.  During the fastening process, robot maintains
        contact with objects along insertion direction while behaving compliant motion in 
        specified direction. </pt_desc>
        <!-- ==================================================================
         ui parameter configuration (optional)
         check more detailed setting in CommonParams.xml
         ====================================================================-->
        <ui_par_config>
            <icon>:blockpalette/images/block/icon_Assembly.svg</icon>
        </ui_par_config>
        <!-- ===================================================================
         input parameter configuration

         par_type : "CART_POS", "QUAT", "POSE", "BOOL", "DOUBLE", "INT", "STRING"
         par_input_type : "KEYIN", "TEACH" , "PT"
         ====================================================================-->
        <input_par_config>
            <par_name> insertDir </par_name>
            <par_desc> "insert direction in TCP coordinate. " </par_desc>
            <par_type> TYPE </par_type>
            <par_required> 1 </par_required>
            <par_unit> none </par_unit>
            <par_option> X -X Y -Y Z -Z  </par_option>
        </input_par_config>
        <input_par_config>
            <par_name> stiffnessScale</par_name>
            <par_desc> "Stiffness scale in TCP coordinate while fastening the screw. Lower scale applies higher motion compliance" </par_desc>
            <par_type> DOUBLE </par_type>
            <par_unit> none </par_unit>
            <par_required> 0 </par_required>
            <par_default> 0.5 </par_default>
            <par_max> 1 </par_max>
            <par_min> 0.1</par_min>
        </input_par_config>
        <input_par_config>
            <par_name> maxContactForce </par_name>
            <par_desc> "maximum contact force between robot and environment. Robot would stop insertion
                        if contact force exceed this value" </par_desc>
            <par_type> DOUBLE </par_type>
            <par_unit> N </par_unit>
            <par_min> 10 </par_min>
            <par_max> 50 </par_max>
            <par_required> 0 </par_required>
            <par_default> 20  </par_default>
        </input_par_config>
        <input_par_config>
            <par_name> insertVel </par_name>
            <par_desc> "velocity in insertion direction" </par_desc>
            <par_type> DOUBLE </par_type>
            <par_unit> m/s </par_unit>
            <par_required> 0 </par_required>
            <par_default> 0.01  </par_default>
            <par_max> 0.05 </par_max>
            <par_min> 0.001 </par_min>
        </input_par_config>
        <input_par_config>
            <par_name> ioScrewInHole</par_name>
            <par_desc> " IO ports which revecives an IO signal from screw gun, indicating that screw 
                        has been tightened a bit into the screw hole. choose NONE if screw gun can not
                        provide this signal" </par_desc>
            <par_type> TYPE </par_type>
            <par_unit> none </par_unit>
            <par_required> 1 </par_required>
            <par_option> NONE gpioIn0 gpioIn1 gpioIn2 gpioIn3 gpioIn4 gpioIn5 gpioIn6 gpioIn7 
                         gpioIn8 gpioIn9 gpioIn10 gpioIn11 gpioIn12 gpioIn13 gpioIn14 gpioIn15 
                         modbusIn0 modbusIn1 modbusIn2 modbusIn3 modbusIn4 modbusIn5 modbusIn6 modbusIn7 
                         modbusIn8 modbusIn9 modbusIn10 modbusIn11 modbusIn12 modbusIn13 modbusIn14 modbusIn15 </par_option>
        </input_par_config>
        <input_par_config>
            <par_name> ioFinish</par_name>
            <par_desc> " IO ports which receives an IO signal from screw gun, indicating that screw 
                        has been totally tightened into the screw hole." </par_desc>
            <par_type> TYPE </par_type>
            <par_unit> none </par_unit>
            <par_required> 1 </par_required>
            <par_option> NONE gpioIn0 gpioIn1 gpioIn2 gpioIn3 gpioIn4 gpioIn5 gpioIn6 gpioIn7 
                         gpioIn8 gpioIn9 gpioIn10 gpioIn11 gpioIn12 gpioIn13 gpioIn14 gpioIn15 
                         modbusIn0 modbusIn1 modbusIn2 modbusIn3 modbusIn4 modbusIn5 modbusIn6 modbusIn7 
                         modbusIn8 modbusIn9 modbusIn10 modbusIn11 modbusIn12 modbusIn13 modbusIn14 modbusIn15 </par_option>
        </input_par_config>
        <input_par_config>
            <par_name> ioScrewJam </par_name>
            <par_desc> " IO ports which revecives an IO signal from screw gun, indicating that screw 
                        has been jammed in the screw hole." </par_desc>
            <par_type> TYPE </par_type>
            <par_unit> none </par_unit>
            <par_required> 1 </par_required>
            <par_option> NONE gpioIn0 gpioIn1 gpioIn2 gpioIn3 gpioIn4 gpioIn5 gpioIn6 gpioIn7 
                         gpioIn8 gpioIn9 gpioIn10 gpioIn11 gpioIn12 gpioIn13 gpioIn14 gpioIn15 
                         modbusIn0 modbusIn1 modbusIn2 modbusIn3 modbusIn4 modbusIn5 modbusIn6 modbusIn7 
                         modbusIn8 modbusIn9 modbusIn10 modbusIn11 modbusIn12 modbusIn13 modbusIn14 modbusIn15 </par_option>
        </input_par_config>
        <!-- ===================================================================
         state parameter configuration
         ====================================================================-->
        <state_par_config>
            <par_name> insertDis </par_name>
            <par_desc> "robot moving distance in insert direction" </par_desc>
            <par_type> DOUBLE </par_type>
            <par_unit> m </par_unit>
        </state_par_config>
        <state_par_config>
            <par_name> insertVel </par_name>
            <par_desc> "robot moving velocity in insert direction" </par_desc>
            <par_type> DOUBLE </par_type>
            <par_unit> m/s </par_unit>
        </state_par_config>
        <state_par_config>
            <par_name> isFinished </par_name>
            <par_desc> "flag if screw fasten has been finished" </par_desc>
            <par_type> BOOL </par_type>
            <par_unit> none </par_unit>
        </state_par_config>
        <state_par_config>
            <par_name> isJammed </par_name>
            <par_desc> "flag if screw is jammed" </par_desc>
            <par_type> BOOL </par_type>
            <par_unit> none </par_unit>
        </state_par_config>
        <state_par_config>
            <par_name> isScrewIn </par_name>
            <par_desc> "flag if screw is in the screw hole" </par_desc>
            <par_type> BOOL </par_type>
            <par_unit> none </par_unit>
        </state_par_config>
        <state_par_config>
            <par_name> reachedScrewHole </par_name>
            <par_desc> "flag if robot has reached full contact with screw hole" </par_desc>
            <par_type> BOOL </par_type>
            <par_unit> none </par_unit>
        </state_par_config>
        <!-- ==================================================================
         default transition condition  
          condition_type : trigger condition type    
          lhs_param_name : LHS parameter name. It must be one of the state parameters in primitive  
          lhs_param_category : LHS parameter category. This should be PT_STATE for now 
          rhs_param_name (optional): RHS parameter name. no need to fill this field if rhs is a constant.
          rhs_param_category : RHS parameter category 
          rhs_param_data (optional) : RHS parameter data. 
         ====================================================================-->
        <default_transition_condition>
            <condition_type> EQUAL</condition_type>
            <lhs_param_name>isFinished</lhs_param_name>
            <lhs_param_category>PT_STATE</lhs_param_category>
            <rhs_param_category>CONST</rhs_param_category>
            <rhs_param_data>1</rhs_param_data>
        </default_transition_condition>
    </primitive>
</fvr>
